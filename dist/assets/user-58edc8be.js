import{getIdToken as s,signOut as a}from"./client-c375c8af.js";let t=null,o=[];async function l(){const e=await s();if(!e)return t=null,r(),null;try{const n=await fetch("/api/me",{headers:{Authorization:`Bearer ${e}`}});if(!n.ok){if(n.status===401)return t=null,r(),null;throw new Error(`API error: ${n.status}`)}return t=await n.json(),r(),t}catch(n){return console.error("Failed to sync profile:",n),t=null,r(),null}}function f(){return(t==null?void 0:t.user)??null}function h(){return(t==null?void 0:t.planId)??"free"}function d(){return t}function g(){return t!==null}function y(){a(),t=null,r()}function w(e){return o.push(e),()=>{o=o.filter(n=>n!==e)}}async function A(e,n={}){const u=await s(),i=new Headers(n.headers);return u&&i.set("Authorization",`Bearer ${u}`),fetch(e,{...n,headers:i})}async function p(){return l()}function r(){for(const e of o)try{e(t)}catch(n){console.error("Auth state listener error:",n)}}export{A as fetchWithAuth,h as getPlanId,f as getProfile,d as getUserState,p as initAuth,g as isLoggedIn,y as logout,w as onAuthStateChange,l as syncProfile};
