import"./modulepreload-polyfill-3cfb730f.js";import{_ as f}from"./preload-helper-cf010ec4.js";let E="",L="";function i(e){return document.getElementById(e)}function l(e){document.querySelectorAll(".login-view").forEach(t=>t.classList.remove("active"));const n=i(e);n&&(n.classList.add("active"),n.style.animation="none",n.offsetHeight,n.style.animation=""),U()}function u(e,n){const t=i(e);if(!t)return;t.disabled=n;const o=t.querySelector(".btn-text"),r=t.querySelector(".btn-spinner");o&&(o.style.opacity=n?"0.6":"1"),r&&(r.hidden=!n)}function d(e,n){const t=i(e);t&&(t.textContent=n);const o=document.querySelector(`#${e.replace("-error","")}`);o&&o.classList.toggle("error",!!n)}function b(...e){e.forEach(n=>d(n,""))}function p(e){const n=i("globalThis-error");n&&(n.textContent=e,n.hidden=!1);const t=i("globalThis-success");t&&(t.hidden=!0)}function I(e){const n=i("globalThis-success");n&&(n.textContent=e,n.hidden=!1);const t=i("globalThis-error");t&&(t.hidden=!0)}function U(){const e=i("globalThis-error"),n=i("globalThis-success");e&&(e.hidden=!0),n&&(n.hidden=!0)}function T(){return new URLSearchParams(window.location.search).get("returnUrl")||"/"}function x(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function C(e){return{length:e.length>=8,upper:/[A-Z]/.test(e),lower:/[a-z]/.test(e),number:/[0-9]/.test(e),valid:e.length>=8&&/[A-Z]/.test(e)&&/[a-z]/.test(e)&&/[0-9]/.test(e)}}function V(e){const n=C(e),t=(o,r)=>{const s=i(o);s&&s.classList.toggle("valid",r)};t("rule-length",n.length),t("rule-upper",n.upper),t("rule-lower",n.lower),t("rule-number",n.number)}function h(e){switch((e==null?void 0:e.code)||(e==null?void 0:e.name)||""){case"UserNotFoundException":return"No existe una cuenta con ese email.";case"NotAuthorizedException":return"Email o contraseña incorrectos.";case"UsernameExistsException":return"Ya existe una cuenta con ese email.";case"CodeMismatchException":return"Código de verificación incorrecto.";case"ExpiredCodeException":return"El código ha expirado. Solicitá uno nuevo.";case"InvalidPasswordException":return"La contraseña no cumple los requisitos mínimos.";case"UserNotConfirmedException":return"Tu cuenta no está verificada. Revisá tu email.";case"LimitExceededException":return"Demasiados intentos. Esperá un momento.";default:return(e==null?void 0:e.message)||"Error inesperado. Intentá de nuevo."}}async function A(){try{const{syncProfile:e}=await f(()=>import("./user-58edc8be.js"),["assets/user-58edc8be.js","assets/client-c375c8af.js"]);await e()}catch(e){console.warn("Failed to sync profile after login:",e)}window.location.href=T()}function O(){var t,o,r,s,g,v,w,m,y,a,_,k,D,P,R;const n=new URLSearchParams(window.location.search).get("code");if(n){$(n);return}(t=i("link-to-signup"))==null||t.addEventListener("click",c=>{c.preventDefault(),l("view-signup")}),(o=i("link-to-signin"))==null||o.addEventListener("click",c=>{c.preventDefault(),l("view-signin")}),(r=i("link-back-signin"))==null||r.addEventListener("click",c=>{c.preventDefault(),l("view-signin")}),(s=i("link-back-signin2"))==null||s.addEventListener("click",c=>{c.preventDefault(),l("view-signin")}),(g=i("link-back-signin3"))==null||g.addEventListener("click",c=>{c.preventDefault(),l("view-signin")}),(v=i("link-forgot"))==null||v.addEventListener("click",c=>{c.preventDefault(),l("view-forgot1")}),(w=i("signup-password"))==null||w.addEventListener("input",c=>{V(c.target.value)}),(m=i("btn-google-signin"))==null||m.addEventListener("click",S),(y=i("btn-google-signup"))==null||y.addEventListener("click",S),(a=i("form-signin"))==null||a.addEventListener("submit",F),(_=i("form-signup"))==null||_.addEventListener("submit",q),(k=i("form-verify"))==null||k.addEventListener("submit",G),(D=i("form-forgot1"))==null||D.addEventListener("submit",z),(P=i("form-forgot2"))==null||P.addEventListener("submit",Y),(R=i("link-resend"))==null||R.addEventListener("click",N)}async function F(e){var o,r;e.preventDefault(),b("signin-email-error","signin-password-error");const n=(((o=i("signin-email"))==null?void 0:o.value)||"").trim(),t=((r=i("signin-password"))==null?void 0:r.value)||"";if(!n||!x(n)){d("signin-email-error","Ingresá un email válido.");return}if(!t){d("signin-password-error","Ingresá tu contraseña.");return}u("btn-signin",!0);try{const{signIn:s}=await f(()=>import("./client-c375c8af.js"),[]);await s(n,t),await A()}catch(s){if((s==null?void 0:s.code)==="UserNotConfirmedException"){E=n,L=t;const g=i("verify-email-display");g&&(g.textContent=n),l("view-verify")}else p(h(s))}finally{u("btn-signin",!1)}}async function q(e){var v,w,m,y;e.preventDefault(),b("signup-email-error","signup-password-error","signup-confirm-error");const n=(((v=i("signup-name"))==null?void 0:v.value)||"").trim(),t=(((w=i("signup-email"))==null?void 0:w.value)||"").trim(),o=((m=i("signup-password"))==null?void 0:m.value)||"",r=((y=i("signup-confirm"))==null?void 0:y.value)||"";let s=!1;if((!t||!x(t))&&(d("signup-email-error","Ingresá un email válido."),s=!0),C(o).valid||(d("signup-password-error","La contraseña no cumple los requisitos."),s=!0),o!==r&&(d("signup-confirm-error","Las contraseñas no coinciden."),s=!0),!s){u("btn-signup",!0);try{const{signUp:a}=await f(()=>import("./client-c375c8af.js"),[]);await a(t,o,n||void 0),E=t,L=o;const _=i("verify-email-display");_&&(_.textContent=t),l("view-verify")}catch(a){console.error("[signup] Raw Cognito error:",(a==null?void 0:a.code)||(a==null?void 0:a.name),a==null?void 0:a.message,a),p(h(a))}finally{u("btn-signup",!1)}}}async function G(e){var t;e.preventDefault(),b("verify-code-error");const n=(((t=i("verify-code"))==null?void 0:t.value)||"").trim();if(!n){d("verify-code-error","Ingresá el código.");return}u("btn-verify",!0);try{const{confirmSignUp:o,signIn:r}=await f(()=>import("./client-c375c8af.js"),[]);await o(E,n),L?(await r(E,L),await A()):(I("¡Cuenta verificada! Ya podés iniciar sesión."),l("view-signin"))}catch(o){p(h(o))}finally{u("btn-verify",!1)}}async function N(e){if(e.preventDefault(),!!E)try{const{resendConfirmationCode:n}=await f(()=>import("./client-c375c8af.js"),[]);await n(E),I("Código reenviado. Revisá tu email.")}catch(n){p(h(n))}}async function z(e){var t;e.preventDefault(),b("forgot-email-error");const n=(((t=i("forgot-email"))==null?void 0:t.value)||"").trim();if(!n||!x(n)){d("forgot-email-error","Ingresá un email válido.");return}u("btn-forgot-send",!0);try{const{forgotPassword:o}=await f(()=>import("./client-c375c8af.js"),[]);await o(n),E=n;const r=i("forgot-email-display");r&&(r.textContent=n),l("view-forgot2")}catch(o){p(h(o))}finally{u("btn-forgot-send",!1)}}async function Y(e){var g,v,w;e.preventDefault(),b("forgot-code-error","forgot-newpass-error","forgot-confirm-error");const n=(((g=i("forgot-code"))==null?void 0:g.value)||"").trim(),t=((v=i("forgot-newpass"))==null?void 0:v.value)||"",o=((w=i("forgot-confirm"))==null?void 0:w.value)||"";let r=!1;if(n||(d("forgot-code-error","Ingresá el código."),r=!0),C(t).valid||(d("forgot-newpass-error","La contraseña no cumple los requisitos."),r=!0),t!==o&&(d("forgot-confirm-error","Las contraseñas no coinciden."),r=!0),!r){u("btn-forgot-confirm",!0);try{const{confirmForgotPassword:m}=await f(()=>import("./client-c375c8af.js"),[]);await m(E,n,t),I("¡Contraseña cambiada! Ya podés iniciar sesión."),l("view-signin")}catch(m){p(h(m))}finally{u("btn-forgot-confirm",!1)}}}async function S(){try{const{isCognitoConfigured:e,signInWithGoogle:n}=await f(()=>import("./client-c375c8af.js"),[]);if(!e()){p("Google Sign-In no está configurado todavía. Configurá las variables de Cognito en .env");return}sessionStorage.setItem("easydrill-returnUrl",T()),n()}catch(e){p("Error al cargar el módulo de autenticación: "+(e.message||""))}}async function $(e){l("view-signin"),u("btn-signin",!0);try{const{exchangeCodeForTokens:n,storeOAuthTokens:t}=await f(()=>import("./client-c375c8af.js"),[]),{syncProfile:o}=await f(()=>import("./user-58edc8be.js"),["assets/user-58edc8be.js","assets/client-c375c8af.js"]),r=await n(e);t(r);const s=sessionStorage.getItem("easydrill-returnUrl")||"/";sessionStorage.removeItem("easydrill-returnUrl"),await o(),window.history.replaceState({},"",window.location.pathname),window.location.href=s}catch(n){p("Error al iniciar sesión con Google: "+(n.message||"")),u("btn-signin",!1)}}O();
